<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gym Progress Dashboard</title>
  <!-- PWA (one-tap app) settings -->
  <meta name="theme-color" content="#0b1220" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root{
      --bg:#0b1220; --card:#121a2b; --muted:#94a3b8; --text:#e5e7eb;
      --accent:#60a5fa; --accent2:#34d399; --danger:#fb7185; --warn:#fbbf24;
      --border:rgba(148,163,184,.18);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#070b14 0%, #0b1220 60%, #070b14 100%);color:var(--text)}
    a{color:inherit}.wrap{max-width:1200px;margin:0 auto;padding:24px}
header{display:flex;gap:16px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:18px}
.title{display:flex;flex-direction:column;gap:6px}
h1{margin:0;font-size:22px;letter-spacing:-.02em}
.sub{color:var(--muted);font-size:13px}

.toolbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.btn{border:1px solid var(--border);background:rgba(255,255,255,.04);color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600;font-size:13px}
.btn:hover{border-color:rgba(96,165,250,.45)}
.btn.primary{background:rgba(96,165,250,.16);border-color:rgba(96,165,250,.35)}
.btn.success{background:rgba(52,211,153,.14);border-color:rgba(52,211,153,.35)}
.btn.danger{background:rgba(251,113,133,.12);border-color:rgba(251,113,133,.35)}

.grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
@media(max-width:980px){.grid{grid-template-columns:1fr}}

.card{background:rgba(18,26,43,.9);border:1px solid var(--border);border-radius:var(--radius);padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.card h2{margin:0 0 12px;font-size:14px;color:#cbd5e1;letter-spacing:.02em;text-transform:uppercase}

.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media(max-width:700px){.kpis{grid-template-columns:1fr}}
.kpi{padding:12px;border-radius:14px;border:1px solid var(--border);background:rgba(255,255,255,.03)}
.kpi .label{color:var(--muted);font-size:12px}
.kpi .val{font-size:20px;font-weight:700;margin-top:6px}
.kpi .hint{color:var(--muted);font-size:12px;margin-top:6px}

.tabs{display:flex;gap:8px;margin-bottom:10px}
.tab{flex:1;min-width:120px;text-align:center;padding:10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.02);cursor:pointer;font-weight:700;font-size:13px;color:#cbd5e1}
.tab.active{background:rgba(52,211,153,.12);border-color:rgba(52,211,153,.35);color:#d1fae5}

form{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
@media(max-width:980px){form{grid-template-columns:repeat(3,1fr)}}
@media(max-width:560px){form{grid-template-columns:repeat(2,1fr)}}

label{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--muted)}
input,select{width:100%;padding:10px 10px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--text);outline:none}
input:focus,select:focus{border-color:rgba(96,165,250,.55)}

.span2{grid-column:span 2}
.actions{grid-column:1/-1;display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-top:4px}
.note{color:var(--muted);font-size:12px}

.chartWrap{height:300px}

.tableWrap{overflow:auto;border-radius:14px;border:1px solid var(--border)}
table{width:100%;border-collapse:collapse;background:rgba(255,255,255,.02)}
th,td{padding:10px 10px;border-bottom:1px solid var(--border);font-size:13px;white-space:nowrap}
th{color:#cbd5e1;font-size:12px;text-transform:uppercase;letter-spacing:.02em;background:rgba(255,255,255,.03);position:sticky;top:0}
td{color:#e5e7eb}

.pill{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);font-size:12px;color:#cbd5e1;background:rgba(255,255,255,.02)}
.pill.str{border-color:rgba(96,165,250,.35);background:rgba(96,165,250,.10)}
.pill.car{border-color:rgba(52,211,153,.35);background:rgba(52,211,153,.10)}

.rowBtns{display:flex;gap:8px;align-items:center;justify-content:flex-end}
.mini{padding:6px 9px;border-radius:10px;font-size:12px}

.badges{display:flex;flex-wrap:wrap;gap:8px}
.badge{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.03);font-size:12px;color:#e5e7eb}
.badge.good{border-color:rgba(52,211,153,.35);background:rgba(52,211,153,.10)}
.badge.warn{border-color:rgba(251,191,36,.35);background:rgba(251,191,36,.10)}
.badge.pb{border-color:rgba(96,165,250,.35);background:rgba(96,165,250,.10)}

.pbGrid{display:grid;grid-template-columns:1fr;gap:10px}
.pbItem{padding:12px;border-radius:14px;border:1px solid var(--border);background:rgba(255,255,255,.03)}
.pbTop{display:flex;align-items:baseline;justify-content:space-between;gap:10px}
.pbName{font-weight:800;letter-spacing:-.01em}
.pbVal{font-weight:800}
.pbMeta{margin-top:6px;color:var(--muted);font-size:12px;line-height:1.5}

footer{margin-top:16px;color:var(--muted);font-size:12px;text-align:center}

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Gym Progress Dashboard</h1>
        <div class="sub">Fast entry • Tables + charts • Personal bests + badges • Saves to this browser (localStorage) • Export to CSV</div>
      </div>
      <div class="toolbar">
        <button class="btn" id="exportCsvBtn">Export CSV</button>
        <label class="btn" style="display:inline-flex;align-items:center;gap:8px;cursor:pointer">
          Import CSV
          <input id="importCsvInput" type="file" accept=".csv" style="display:none" />
        </label>
        <button class="btn danger" id="resetBtn" title="Deletes all saved data">Reset</button>
      </div>
    </header><div class="grid">
  <div class="card">
    <h2>Quick Stats (last 28 days)</h2>
    <div class="kpis">
      <div class="kpi">
        <div class="label">Gym sessions</div>
        <div class="val" id="kpiSessions">0</div>
        <div class="hint" id="kpiStreak">Streak: 0 days</div>
      </div>
      <div class="kpi">
        <div class="label">Strength volume</div>
        <div class="val" id="kpiVolume">0</div>
        <div class="hint">Sum of (weight × reps × sets)</div>
      </div>
      <div class="kpi">
        <div class="label">Cardio time</div>
        <div class="val" id="kpiCardio">0 min</div>
        <div class="hint">Total minutes logged</div>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Goals + Badges</h2>
    <div class="note" style="line-height:1.6;margin-bottom:10px">
      Set weekly goals and earn badges automatically.
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
      <label>Weekly gym sessions goal
        <input id="goalSessions" type="number" min="1" step="1" />
      </label>
      <label>Weekly cardio minutes goal
        <input id="goalCardio" type="number" min="0" step="5" />
      </label>
    </div>
    <div style="display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-top:10px">
      <button class="btn success" id="saveGoalsBtn">Save goals</button>
      <div class="note" id="goalStatus">This week: 0 sessions • 0 cardio min</div>
    </div>

    <div style="margin-top:12px" class="badges" id="badgesWrap"></div>
  </div>

  <div class="card">
    <h2>Easy Data Entry</h2>
    <div class="tabs">
      <button class="tab active" id="tabStrength">Strength</button>
      <button class="tab" id="tabCardio">Cardio</button>
    </div>

    <form id="strengthForm">
      <label class="span2">Date
        <input type="date" id="sDate" required />
      </label>
      <label class="span2">Muscle group
        <select id="sGroup" required>
          <option value="Arms">Arms</option>
          <option value="Chest">Chest</option>
          <option value="Legs">Legs</option>
          <option value="Back">Back</option>
          <option value="Shoulders">Shoulders</option>
          <option value="Core">Core</option>
        </select>
      </label>
      <label class="span2">Machine / exercise
        <input id="sExercise" placeholder="e.g., Chest Press" required />
      </label>

      <label>Weight
        <input id="sWeight" type="number" step="0.5" min="0" placeholder="kg" required />
      </label>
      <label>Reps
        <input id="sReps" type="number" step="1" min="1" placeholder="e.g., 10" required />
      </label>
      <label>Sets
        <input id="sSets" type="number" step="1" min="1" value="3" required />
      </label>

      <div class="actions">
        <div class="note">Auto-calculates volume = weight × reps × sets</div>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <button class="btn primary" type="submit">Add Strength Entry</button>
          <button class="btn" type="button" id="sClear">Clear</button>
        </div>
      </div>
    </form>

    <form id="cardioForm" style="display:none">
      <label class="span2">Date
        <input type="date" id="cDate" required />
      </label>
      <label class="span2">Machine
        <select id="cMachine" required>
          <option value="Treadmill">Treadmill</option>
          <option value="Bike">Bike</option>
          <option value="Stepper">Stepper</option>
          <option value="Rowing">Rowing</option>
          <option value="Elliptical">Elliptical</option>
        </select>
      </label>
      <label class="span2">Intensity (optional)
        <select id="cIntensity">
          <option value="Easy">Easy</option>
          <option value="Medium" selected>Medium</option>
          <option value="Hard">Hard</option>
        </select>
      </label>

      <label>Minutes
        <input id="cMinutes" type="number" step="1" min="1" placeholder="e.g., 20" required />
      </label>
      <label>Distance
        <input id="cDistance" type="number" step="0.1" min="0" placeholder="km (optional)" />
      </label>
      <label>Notes
        <input id="cNotes" placeholder="e.g., incline 6" />
      </label>

      <div class="actions">
        <div class="note">Distance is optional — minutes alone is enough.</div>
        <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
          <button class="btn primary" type="submit">Add Cardio Entry</button>
          <button class="btn" type="button" id="cClear">Clear</button>
        </div>
      </div>
    </form>
  </div>

  <div class="card">
    <h2>Personal Bests</h2>
    <div class="note" style="line-height:1.6;margin-bottom:10px">
      These update automatically as he logs more workouts.
    </div>
    <div class="pbGrid" id="pbWrap"></div>
  </div>

  <div class="card">
    <h2>Charts</h2>
    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px">
      <label style="min-width:220px">Chart view
        <select id="chartMode">
          <option value="strength_volume">Strength volume (weekly)</option>
          <option value="strength_best">Best weight (weekly max)</option>
          <option value="cardio_minutes">Cardio minutes (weekly)</option>
          <option value="cardio_distance">Cardio distance (weekly)</option>
        </select>
      </label>
      <label style="min-width:220px" id="groupFilterWrap">Muscle group
        <select id="groupFilter">
          <option value="All">All</option>
          <option value="Arms">Arms</option>
          <option value="Chest">Chest</option>
          <option value="Legs">Legs</option>
          <option value="Back">Back</option>
          <option value="Shoulders">Shoulders</option>
          <option value="Core">Core</option>
        </select>
      </label>
    </div>
    <div class="chartWrap"><canvas id="chart"></canvas></div>
    <div class="note" style="margin-top:10px">Aim for: volume trending up (strength) and minutes/distance trending up (cardio).</div>
  </div>

  <div class="card" style="grid-column:1/-1">
    <h2>All Entries</h2>
    <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:flex-end;margin-bottom:10px">
      <label>Filter type
        <select id="filterType">
          <option value="All">All</option>
          <option value="Strength">Strength</option>
          <option value="Cardio">Cardio</option>
        </select>
      </label>
      <label>Search
        <input id="search" placeholder="type to search (e.g., leg press, treadmill)" />
      </label>
      <div style="margin-left:auto;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span class="note" id="entryCount">0 entries</span>
      </div>
    </div>

    <div class="tableWrap">
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Group / Machine</th>
            <th>Exercise</th>
            <th>Details</th>
            <th style="text-align:right">Actions</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<footer>
  Data is saved in this browser only. If you use another device/browser, export CSV and import it there.
</footer>

  </div><script>
  const STORAGE_KEY = "gym_progress_entries_v1";
  const SETTINGS_KEY = "gym_progress_settings_v1";
  const LAST_PB_KEY = "gym_progress_last_pb_v1";

  let entries = load();
  let settings = loadSettings();

  const todayStr = new Date().toISOString().slice(0,10);
  document.getElementById('sDate').value = todayStr;
  document.getElementById('cDate').value = todayStr;

  document.getElementById('goalSessions').value = String(settings.goalSessions ?? 3);
  document.getElementById('goalCardio').value = String(settings.goalCardio ?? 60);

  document.getElementById('saveGoalsBtn').addEventListener('click', () => {
    const gs = Number(document.getElementById('goalSessions').value);
    const gc = Number(document.getElementById('goalCardio').value);
    settings.goalSessions = Number.isFinite(gs) && gs > 0 ? Math.floor(gs) : 3;
    settings.goalCardio = Number.isFinite(gc) && gc >= 0 ? Math.floor(gc) : 60;
    saveSettings();
    renderAll();
  });

  // Tabs
  const tabStrength = document.getElementById('tabStrength');
  const tabCardio = document.getElementById('tabCardio');
  const strengthForm = document.getElementById('strengthForm');
  const cardioForm = document.getElementById('cardioForm');

  tabStrength.addEventListener('click', () => setTab('strength'));
  tabCardio.addEventListener('click', () => setTab('cardio'));

  function setTab(which){
    const isStrength = which === 'strength';
    tabStrength.classList.toggle('active', isStrength);
    tabCardio.classList.toggle('active', !isStrength);
    strengthForm.style.display = isStrength ? '' : 'none';
    cardioForm.style.display = isStrength ? 'none' : '';
  }

  // Add strength
  strengthForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const date = val('sDate');
    const group = val('sGroup');
    const exercise = val('sExercise').trim();
    const weight = num('sWeight');
    const reps = num('sReps');
    const sets = num('sSets');
    const volume = round(weight * reps * sets);

    if(!exercise) return;

    const pb = detectPBStrength({exercise, weight, volume});

    entries.push({
      id: crypto.randomUUID(),
      type: 'Strength',
      date, group, exercise,
      weight, reps, sets,
      volume
    });

    if(pb) setLastPB(pb);

    save();
    renderAll();

    document.getElementById('sWeight').value = '';
    document.getElementById('sReps').value = '';
    document.getElementById('sSets').value = '3';
    document.getElementById('sWeight').focus();
  });

  document.getElementById('sClear').addEventListener('click', () => {
    strengthForm.reset();
    document.getElementById('sDate').value = todayStr;
    document.getElementById('sSets').value = '3';
  });

  // Add cardio
  cardioForm.addEventListener('submit', (e) => {
    e.preventDefault();

    const date = val('cDate');
    const machine = val('cMachine');
    const intensity = val('cIntensity');
    const minutes = num('cMinutes');
    const distanceStr = document.getElementById('cDistance').value;
    const distance = distanceStr === '' ? null : Number(distanceStr);
    const notes = val('cNotes').trim();

    const pb = detectPBCardio({machine, minutes, distance});

    entries.push({
      id: crypto.randomUUID(),
      type: 'Cardio',
      date, machine, intensity,
      minutes,
      distance: (distance === null || Number.isNaN(distance)) ? null : distance,
      notes
    });

    if(pb) setLastPB(pb);

    save();
    renderAll();

    document.getElementById('cMinutes').value = '';
    document.getElementById('cDistance').value = '';
    document.getElementById('cNotes').value = '';
    document.getElementById('cMinutes').focus();
  });

  document.getElementById('cClear').addEventListener('click', () => {
    cardioForm.reset();
    document.getElementById('cDate').value = todayStr;
    document.getElementById('cIntensity').value = 'Medium';
  });

  // Filters
  document.getElementById('filterType').addEventListener('change', renderTable);
  document.getElementById('search').addEventListener('input', renderTable);

  // Chart controls
  document.getElementById('chartMode').addEventListener('change', renderChart);
  document.getElementById('groupFilter').addEventListener('change', renderChart);

  // Export / Import
  document.getElementById('exportCsvBtn').addEventListener('click', exportCsv);
  document.getElementById('importCsvInput').addEventListener('change', importCsv);

  // Reset
  document.getElementById('resetBtn').addEventListener('click', () => {
    if(!confirm('Reset deletes all entries from this browser. Continue?')) return;
    entries = [];
    save();
    renderAll();
  });

  // Render
  let chart;
  function renderAll(){
    sortEntries();
    renderKPIs();
    renderGoalsBadges();
    renderPBs();
    renderTable();
    renderChart();
  }

  function sortEntries(){
    entries.sort((a,b) => (a.date < b.date ? 1 : a.date > b.date ? -1 : 0));
  }

  function renderKPIs(){
    const since = daysAgo(28);
    const last28 = entries.filter(e => e.date >= since);
    const sessions = new Set(last28.map(e => e.date)).size;

    const strengthVol = last28.filter(e => e.type === 'Strength').reduce((s,e) => s + (e.volume || 0), 0);
    const cardioMin = last28.filter(e => e.type === 'Cardio').reduce((s,e) => s + (e.minutes || 0), 0);

    document.getElementById('kpiSessions').textContent = sessions;
    document.getElementById('kpiVolume').textContent = fmtNumber(strengthVol);
    document.getElementById('kpiCardio').textContent = `${fmtNumber(cardioMin)} min`;

    document.getElementById('kpiStreak').textContent = `Streak: ${calcStreak()} days`;
  }

  function calcStreak(){
    const dates = new Set(entries.map(e => e.date));
    let streak = 0;
    let d = new Date();
    for(;;){
      const ds = d.toISOString().slice(0,10);
      if(dates.has(ds)){
        streak++;
        d.setDate(d.getDate() - 1);
      } else break;
    }
    return streak;
  }

  function renderGoalsBadges(){
    const { sessionsThisWeek, cardioMinutesThisWeek } = thisWeekTotals();
    do